<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Kingdom Map</title>
<base target="_parent">
<style type="text/css">
* { overflow: hidden; border: none; margin: 0; padding: 0; white-space: nowrap; }
</style>
<script type="text/javascript"><!--
var hexsize = 60;

function receivejson ()
{
	jsonresponse = this.responseText;
	console.log(this.responseURL);
	console.log(this.responseText);
}

function getjson(path)
{
	var xhr = new XMLHttpRequest();
	xhr.open("GET", path);
	xhr.onload = receivejson;
	xhr.send();
}

function gettile(x, y)
{
	var terrain="grass";
	var img = document.createElement("img");
	img.src = terrain + ".png";
	img.id = "i" + x + "-" + y;
	img.useMap = "#a" + x + "-" + y;
	img.style.display = "inline";
	img.style.width = hexsize + "px";
	img.style.height = hexsize + "px";
	return img;
}

function getmap(x, y)
{
	var coord_nw = "0," + (hexsize/4);
	var coord_nn = (hexsize/2) + ",0";
	var coord_ne = hexsize + "," + (hexsize/4);
	var coord_se = hexsize + "," + (hexsize*3/4);
	var coord_ss = (hexsize/2) + "," + hexsize;
	var coord_sw = "0," + (hexsize*3/4);
	var map = document.createElement("map");
	map.style.display = "none";
	map.name = "a" + x + "-" + y;
	var area = document.createElement("area");
	area.style.display = "none";
	area.shape = "poly";
	area.coords = coord_nw + "," + coord_nn + "," + coord_ne + "," + coord_se + "," + coord_ss + "," + coord_sw;
	area.href = "FIXME-" + x + "-" + y;
	map.appendChild(area);
	return map;
}

function drawmap(width, height)
{
	var nw_halves=['1-4', '2-2', '3-1'];
	var ne_halves=['1-6', '2-7', '3-9'];
	var ww_halves=['5-0', '7-0', '9-0'];
	var ee_halves=['5-10', '7-10', '9-10'];
	var sw_halves=['11-1', '12-2', '13-4'];
	var se_halves=['11-9', '12-7', '13-6'];

	var body = document.getElementsByTagName("body");
	for (var i = 0; i < height; i++) {
		var div = document.createElement("div");
		div.style.marginTop = "-" + (hexsize/3) + "px";
		for (var j = 0; j < width; j++) {
			div.appendChild(gettile(i, j));
			div.appendChild(getmap(i, j));
		}
		if (i % 2 == 1) {
			div.appendChild(gettile(i, 0xa));
			div.appendChild(getmap(i, 0xa));
			div.style.marginLeft = "-" + (hexsize/2) + "px";
		}
		body[0].appendChild(div);
	}

	var halves = nw_halves.concat(ne_halves).concat(ww_halves).concat(ee_halves).concat(sw_halves).concat(se_halves);
	for (var h in halves) {
		var e = document.getElementById("i" + halves[h]);
		if (e) {
			e.style.opacity = 0.5;
		}
	}
}

function recenter ()
{
	var hexestall = 13;
	var hexeswide = 10;
	var centery = 6;
	var centerx = 6;
	var rcenterx = 7;
	var rcentery = 7;
	var hexwidth = window.innerWidth / hexsize;
	var hexheight = window.innerHeight / (hexsize * .75);
	drawmap(Math.ceil(hexwidth), Math.ceil(hexheight) + 2);
	getjson("/0/0.json");
}

// --></script>
</head>
<body onload="recenter();">
</body>
</html>
